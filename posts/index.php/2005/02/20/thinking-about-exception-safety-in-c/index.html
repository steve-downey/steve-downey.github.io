<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Thinking about Exception Safety in C++ | What Comes to Mind</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link rel="stylesheet" href="../../../../../../assets/css/rst.min.css">
<link rel="stylesheet" href="../../../../../../assets/css/foundation.min.css">
<link rel="stylesheet" href="../../../../../../assets/css/app.css">
<link rel="stylesheet" href="../../../../../../assets/css/modus-vivendi-tinted.css">
<link href="../../../../../../assets/css/custom.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../../../rss.xml">
<link rel="alternate" type="application/atom+xml" title="Atom" href="../../../../../../feed.atom">
<link rel="canonical" href="https://sdowney.org/posts/index.php/2005/02/20/thinking-about-exception-safety-in-c/">
<!--[if lt IE 9]><script src="../../../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Steve Downey">
<link rel="prev" href="../../05/more-house-construction/" title="More house construction" type="text/html">
<link rel="next" href="../../../03/13/a-brief-history-of-construction/" title="A brief history of construction:" type="text/html">
<meta property="og:site_name" content="What Comes to Mind">
<meta property="og:title" content="Thinking about Exception Safety in C++">
<meta property="og:url" content="https://sdowney.org/posts/index.php/2005/02/20/thinking-about-exception-safety-in-c/">
<meta property="og:description" content="Thanks to David Abrahams, we have a framework to discuss the relative exception safety of C++ components. Quick reiteration:# The basic guarantee: that the invariants of the component are preserved, a">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2005-02-20T23:26:00-05:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@sdowney.org">
<meta name="twitter:creator" content="@sdowney">
</head>
<body>

    

    
<div class="top-bar">
<div class="top-bar-left">
<ul class="menu">
<li class="menu-text"><a href="https://sdowney.org/" title="What Comes to Mind" rel="home">What Comes to Mind</a></li>
                <li><a href="../../../../../../archive.html">Archives</a></li>
                <li><a href="../../../../../../categories/index.html">Tags</a></li>
                <li><a href="mailto:sdowney@sdowney.dev"><i class="fa fa-envelope"></i></a></li>
                <li><a href="https://github.com/steve-downey">GitHub <i class="fa-brands fa-square-github"></i></a></li>
                <li><a href="https://mastodon.social/@Sdowney">Mastodon <i class="fa-brands fa-mastodon"></i></a></li>
                <li><a href="https://bsky.app/profile/sdowney.bsky.social">Bluesky <i class="fa-brands fa-square-bluesky"></i></a></li>
                <li><a href="../../../../../../feed.atom">ATOM <i class="fa-solid fa-atom"></i></a></li>
                <li><a href="../../../../../../rss.xml">RSS <i class="fa-solid fa-rss"></i></a></li>
    
    
    </ul>
</div>
</div>

    

<div class="callout large primary">
<div class="row column text-center">

    <h1>Thinking about Exception Safety in C++</h1>
    <h2 class="subheader"><small>2005-02-20 23:26</small></h2>

</div>
</div>

<div class="row medium-8 large-7 columns">

<div class="blog-post">
    
    


    <p>Thanks to David Abrahams, we have a framework to discuss the relative <a href="http://www.boost.org/more/generic_exception_safety.html">exception safety</a> of C++ components. Quick reiteration:<br># The basic guarantee: that the invariants of the component are preserved, and no resources are leaked.<br># The strong guarantee: that the operation has either completed successfully or thrown an exception, leaving the program state exactly as it was before the operation started.<br># The no-throw guarantee: that the operation will not throw an exception.<br><br>A corner case, that came up recently in discussion about shared_ptr, is how to describe the situation where the invariants of the component are preserved, the state of the component is what it was before, but the state of the <span>program</span> is not exactly as it was before the operation started.<br><br>shared_ptr potentially can throw an exception during construction. If it does, the pointer that it is constructed on is deleted (or the deleter called). This is important, as it prevents any resource leak. But it does mean that there is a change in the state of the program. Whatever the pointer is pointing to is gone. Does this mean that shared_ptr only provides the basic guarantee?<br><br>That would be unsatsifying.<br><br>The only way out of it that I see is that any attempt to observe the changed state would involve undefined behavior. And it would be the same undefined behavior, at that point in the code, if the operation did succeed.<br><br>Concrete, simple, case:<br><br>Widget * w = new Widget; // 1<br>// ... some more code<br>shared_ptr sp_w = shared_ptr<widget>(w); // 2 <br>// ... yet more code.<br>w-&gt;widgetOp(); // 3<br><br><br>How could we arrive at 3 if an exception was thrown at 2? Only if 2 was inside a try block of some kind, which implies at least one block scope level difference between //1 and //2. <br><br>Which means that when that scope was exited, sp_w would have gone out of scope and been deleted, so that any reference to w at //3 would be invalid.<br><br>It seems to me that the program state in the strong guarantee must be one that is marked as being the beginning of a transaction by opening a try block. That this is necessary, although not sufficient for transactional behavior. Of course to accomplish this, each component must revert its state to the initial conditions, no component can know enough to revert the state of the entire program.</widget></p>

    <div class="callout">
    <ul class="menu simple">
<li>Author: Steve Downey</li>

    </ul>
</div>
    

    
        <div class="column row">
            <ul class="pagination" role="navigation" aria-label="Pagination">
<li>
                    <a href="../../05/more-house-construction/" rel="prev" title="More house construction">« <span class="show-for-sr">Previous post</span></a>
                </li>
                <li>
                    <a href="../../../03/13/a-brief-history-of-construction/" rel="next" title="A brief history of construction:" aria-label="Next page">» <span class="show-for-sr">Next post</span></a>
                </li>
            </ul>
</div>

    
    


</div>



<hr>
<footer id="footer"><p><small>Contents © 2025         <a href="mailto:sdowney@sdowney.dev">Steve Downey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a> - 
 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
 <img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a></small></p>
            
        </footer>
</div>

    



<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VGV27RDN3E"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VGV27RDN3E');
</script>
</body>
</html>
